<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Initialisation Firebase - Sabrine SJK</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #8B7355;
        }
        .section h2 {
            color: #8B7355;
            margin-top: 0;
        }
        button {
            background: linear-gradient(135deg, #8B7355, #C4A77D);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s;
            font-weight: 600;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 115, 85, 0.3);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .log {
            background: #2d3748;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
        }
        .log-success { color: #00ff00; }
        .log-error { color: #ff4444; }
        .log-info { color: #44aaff; }
        .log-warning { color: #ffaa00; }
        .status {
            text-align: center;
            font-size: 18px;
            margin: 20px 0;
            font-weight: 600;
        }
        .status.success { color: #00aa00; }
        .status.error { color: #cc0000; }
        .status.processing { color: #0066cc; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• Initialisation Firebase</h1>
        <p style="text-align: center; color: #666;">
            Cette page initialise les collections Firestore pour le site de Sabrine SJK
        </p>

        <div class="section">
            <h2>üìã Collections √† cr√©er</h2>
            <ul>
                <li><strong>services</strong> - Liste des services disponibles</li>
                <li><strong>settings</strong> - Param√®tres du site</li>
                <li><strong>counters</strong> - Compteurs pour num√©ros de documents</li>
                <li><strong>availability</strong> - Cr√©neaux horaires disponibles</li>
                <li><strong>testimonials</strong> - T√©moignages clients</li>
                <li><strong>bookings</strong> - R√©servations des clients</li>
                <li><strong>clients</strong> - Profils clients</li>
                <li><strong>quotes</strong> - Devis g√©n√©r√©s</li>
                <li><strong>invoices</strong> - Factures (placeholder)</li>
                <li><strong>history</strong> - Historique des activit√©s</li>
            </ul>
        </div>

        <button id="initBtn">
            üöÄ Initialiser Firestore
        </button>

        <div class="status" id="status"></div>

        <div class="log" id="logContainer"></div>
    </div>

    <script type="module">
        import { db, collection, addDoc, setDoc, doc } from './firebase-config.js';

        let logContainer;
        let statusDiv;

        function log(message, type = 'info') {
            if (!logContainer) {
                console.log(`[${type}] ${message}`);
                return;
            }
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            const timestamp = new Date().toLocaleTimeString('fr-FR');
            entry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateStatus(message, type = 'processing') {
            if (!statusDiv) {
                console.log(`[STATUS ${type}] ${message}`);
                return;
            }
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        console.log('‚úÖ Script module charg√©');

        async function initializeFirestore() {
            logContainer = document.getElementById('logContainer');
            statusDiv = document.getElementById('status');
            const btn = document.getElementById('initBtn');

            btn.disabled = true;
            logContainer.innerHTML = '';
            log('üî• D√©but de l\'initialisation Firebase...', 'info');
            updateStatus('Initialisation en cours...', 'processing');

            try {
                // 1. Cr√©er des exemples de services
                log('üì¶ Cr√©ation de la collection "services"...', 'info');
                
                const services = [
                    {
                        id: 'intuitif-adulte',
                        name: 'S√©ance Intuitive Adulte',
                        category: 'S√©ances Intuitives',
                        price: 60,
                        priceDistanciel: 50,
                        duration: 60,
                        description: 'S√©ance compl√®te pour harmoniser le corps, l\'esprit et les √©motions.',
                        active: true,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'intuitif-enfant',
                        name: 'S√©ance Intuitive Enfant',
                        category: 'S√©ances Intuitives',
                        price: 40,
                        priceDistanciel: 30,
                        duration: 45,
                        description: 'S√©ance adapt√©e aux enfants de moins de 12 ans.',
                        active: true,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'reiki-lahochi',
                        name: 'Reiki ou Lahochi',
                        category: 'Reiki & Lahochi',
                        price: 60,
                        duration: 60,
                        description: 'Techniques de gu√©rison √©nerg√©tique japonaise et hawa√Øenne.',
                        active: true,
                        createdAt: new Date().toISOString()
                    }
                ];

                for (const service of services) {
                    await addDoc(collection(db, "services"), service);
                    log(`‚úì Service cr√©√©: ${service.name}`, 'success');
                }

                // 2. Cr√©er des param√®tres par d√©faut
                log('‚öôÔ∏è Cr√©ation de la collection "settings"...', 'info');
                
                await setDoc(doc(db, "settings", "site"), {
                    siteName: 'Sabrine SJK - Th√©rapeute √ânerg√©tique',
                    email: 'sabrine.sjk@gmail.com',
                    phone: '07 86 99 69 50',
                    address: 'Beauvoisin, France',
                    openingHours: {
                        monday: { open: '09:00', close: '18:00', available: true },
                        tuesday: { open: '09:00', close: '18:00', available: true },
                        wednesday: { open: '09:00', close: '18:00', available: true },
                        thursday: { open: '09:00', close: '18:00', available: true },
                        friday: { open: '09:00', close: '18:00', available: true },
                        saturday: { open: '09:00', close: '13:00', available: true },
                        sunday: { available: false }
                    },
                    bookingSlotDuration: 60,
                    maxAdvanceBookingDays: 60,
                    promoActive: true,
                    promoDiscount: 20,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                });
                log('‚úì Param√®tres cr√©√©s', 'success');

                // 3. Cr√©er les compteurs pour les num√©ros de documents
                log('üî¢ Cr√©ation de la collection "counters"...', 'info');
                
                const currentDate = new Date();
                const yearMonth = `${String(currentDate.getFullYear()).slice(2)}${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
                
                await setDoc(doc(db, 'counters', 'bookings'), {
                    prefix: 'RES',
                    currentMonth: yearMonth,
                    count: 0,
                    lastReset: currentDate.toISOString()
                });
                log('‚úì Compteur r√©servations (RES) cr√©√©', 'success');
                
                await setDoc(doc(db, 'counters', 'invoices'), {
                    prefix: 'FACT',
                    currentMonth: yearMonth,
                    count: 0,
                    lastReset: currentDate.toISOString()
                });
                log('‚úì Compteur factures (FACT) cr√©√©', 'success');
                
                await setDoc(doc(db, 'counters', 'quotes'), {
                    prefix: 'DEV',
                    currentMonth: yearMonth,
                    count: 0,
                    lastReset: currentDate.toISOString()
                });
                log('‚úì Compteur devis (DEV) cr√©√©', 'success');

                // 4. Cr√©er des exemples de disponibilit√©s
                log('üìÖ Cr√©ation de la collection "availability"...', 'info');
                
                const today = new Date();
                for (let i = 1; i <= 14; i++) {
                    const date = new Date(today);
                    date.setDate(date.getDate() + i);
                    
                    const slots = [
                        { time: '09:00', available: true },
                        { time: '10:30', available: true },
                        { time: '14:00', available: true },
                        { time: '15:30', available: true },
                        { time: '17:00', available: true }
                    ];

                    await addDoc(collection(db, "availability"), {
                        date: date.toISOString().split('T')[0],
                        slots: slots,
                        createdAt: new Date().toISOString()
                    });
                }
                log('‚úì 14 jours de disponibilit√©s cr√©√©s', 'success');

                // 5. Cr√©er des exemples de t√©moignages
                log('‚≠ê Cr√©ation de la collection "testimonials"...', 'info');
                
                const testimonials = [
                    {
                        name: 'Sophie M.',
                        rating: 5,
                        text: 'Une exp√©rience transformatrice ! Sabrine a su cr√©er un espace de confiance et de bienveillance.',
                        service: 'S√©ance Intuitive',
                        date: new Date().toISOString(),
                        approved: true
                    },
                    {
                        name: 'Marc D.',
                        rating: 5,
                        text: 'Gr√¢ce √† l\'accompagnement de Sabrine, j\'ai retrouv√© s√©r√©nit√© et confiance en moi.',
                        service: 'Reiki',
                        date: new Date().toISOString(),
                        approved: true
                    },
                    {
                        name: 'Julie L.',
                        rating: 5,
                        text: 'Des soins √©nerg√©tiques exceptionnels. Je recommande vivement !',
                        service: 'Lahochi',
                        date: new Date().toISOString(),
                        approved: true
                    }
                ];

                for (const testimonial of testimonials) {
                    await addDoc(collection(db, "testimonials"), testimonial);
                    log(`‚úì T√©moignage cr√©√©: ${testimonial.name}`, 'success');
                }

                // 6. Cr√©er une r√©servation d'exemple avec workflow complet
                log('üìù Cr√©ation des collections du workflow...', 'info');
                
                const exampleDate = new Date();
                exampleDate.setDate(exampleDate.getDate() + 3);
                const exampleDateStr = exampleDate.toISOString().split('T')[0];
                
                // Booking
                await addDoc(collection(db, "bookings"), {
                    bookingNumber: 'RES2512INIT',
                    quoteNumber: 'DEV2512INIT',
                    serviceId: 'intuitif-adulte',
                    serviceName: 'S√©ance Intuitive Adulte',
                    name: 'Marie Exemple',
                    firstname: 'Marie',
                    lastname: 'Exemple',
                    email: 'marie.exemple@email.com',
                    phone: '06 12 34 56 78',
                    date: exampleDateStr,
                    time: '14:00',
                    participants: 1,
                    price: 60,
                    discount: 0,
                    promoDiscount: 0,
                    total: 60,
                    duration: 60,
                    message: 'Ceci est une r√©servation d\'exemple pour tester le syst√®me.',
                    status: 'pending',
                    paymentStatus: 'unpaid',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                });
                log('‚úì Collection "bookings" - r√©servation cr√©√©e', 'success');

                // Client profile
                await setDoc(doc(db, 'clients', 'marie.exemple@email.com'), {
                    email: 'marie.exemple@email.com',
                    name: 'Marie Exemple',
                    firstname: 'Marie',
                    lastname: 'Exemple',
                    phone: '06 12 34 56 78',
                    totalBookings: 1,
                    totalSpent: 0,
                    loyaltyPoints: 0,
                    firstBooking: new Date().toISOString(),
                    lastBooking: new Date().toISOString(),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                });
                log('‚úì Collection "clients" - profil cr√©√©', 'success');

                // Quote
                const validUntil = new Date();
                validUntil.setDate(validUntil.getDate() + 30);
                
                await addDoc(collection(db, 'quotes'), {
                    quoteNumber: 'DEV2512INIT',
                    bookingNumber: 'RES2512INIT',
                    clientEmail: 'marie.exemple@email.com',
                    clientName: 'Marie Exemple',
                    serviceName: 'S√©ance Intuitive Adulte',
                    items: [
                        {
                            description: 'S√©ance Intuitive Adulte',
                            quantity: 1,
                            unitPrice: 60,
                            total: 60
                        }
                    ],
                    subtotal: 60,
                    discount: 0,
                    total: 60,
                    validUntil: validUntil.toISOString(),
                    status: 'pending',
                    terms: 'Ce devis est valable 30 jours. Un acompte de 30% est demand√© pour confirmer la r√©servation.',
                    notes: 'Merci pour votre confiance. N\'h√©sitez pas √† me contacter pour toute question.',
                    createdAt: new Date().toISOString()
                });
                log('‚úì Collection "quotes" - devis cr√©√©', 'success');

                // Invoices - placeholder
                await setDoc(doc(db, 'invoices', '_placeholder'), {
                    description: 'Collection initialis√©e - ce document peut √™tre supprim√©',
                    note: 'Les factures seront cr√©√©es automatiquement lors de la confirmation des r√©servations',
                    createdAt: new Date().toISOString()
                });
                log('‚úì Collection "invoices" - placeholder cr√©√©', 'success');

                // History
                await addDoc(collection(db, 'history'), {
                    type: 'booking_created',
                    bookingNumber: 'RES2512INIT',
                    clientEmail: 'marie.exemple@email.com',
                    description: 'R√©servation cr√©√©e',
                    details: {
                        service: 'S√©ance Intuitive Adulte',
                        date: exampleDateStr,
                        time: '14:00',
                        total: 60
                    },
                    timestamp: new Date().toISOString()
                });
                
                await addDoc(collection(db, 'history'), {
                    type: 'quote_generated',
                    bookingNumber: 'RES2512INIT',
                    quoteNumber: 'DEV2512INIT',
                    clientEmail: 'marie.exemple@email.com',
                    description: 'Devis g√©n√©r√©',
                    details: {
                        total: 60,
                        validUntil: validUntil.toISOString().split('T')[0]
                    },
                    timestamp: new Date().toISOString()
                });
                log('‚úì Collection "history" - 2 entr√©es cr√©√©es', 'success');

                // Succ√®s final
                log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
                log('‚úÖ Initialisation termin√©e avec succ√®s !', 'success');
                log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
                log('', 'info');
                log('üìä Collections cr√©√©es:', 'info');
                log('  ‚Ä¢ services: 3 services', 'info');
                log('  ‚Ä¢ settings: 1 configuration', 'info');
                log('  ‚Ä¢ counters: 3 compteurs (RES, FACT, DEV)', 'info');
                log('  ‚Ä¢ availability: 14 jours', 'info');
                log('  ‚Ä¢ testimonials: 3 t√©moignages', 'info');
                log('  ‚Ä¢ bookings: 1 exemple (RES2512INIT)', 'info');
                log('  ‚Ä¢ clients: 1 profil exemple', 'info');
                log('  ‚Ä¢ quotes: 1 devis exemple (DEV2512INIT)', 'info');
                log('  ‚Ä¢ invoices: placeholder cr√©√©', 'info');
                log('  ‚Ä¢ history: 2 entr√©es d\'historique', 'info');
                log('', 'info');
                log('üéØ Workflow complet initialis√©:', 'info');
                log('  ‚úì Num√©rotation automatique des documents', 'info');
                log('  ‚úì Profils clients avec suivi', 'info');
                log('  ‚úì G√©n√©ration de devis', 'info');
                log('  ‚úì Historique des activit√©s', 'info');
                log('', 'info');
                log('üéâ Vous pouvez maintenant utiliser votre site !', 'success');
                
                updateStatus('‚úÖ Initialisation r√©ussie !', 'success');
                btn.textContent = '‚úì Termin√©';

            } catch (error) {
                log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'error');
                log('‚ùå ERREUR: ' + error.message, 'error');
                log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'error');
                console.error('Erreur compl√®te:', error);
                updateStatus('‚ùå Erreur lors de l\'initialisation', 'error');
                btn.disabled = false;
                btn.textContent = 'üîÑ R√©essayer';
            }
        }

        // Attacher l'√©v√©nement au bouton
        document.addEventListener('DOMContentLoaded', () => {
            console.log('‚úÖ DOM charg√©');
            
            const btn = document.getElementById('initBtn');
            logContainer = document.getElementById('logContainer');
            statusDiv = document.getElementById('status');
            
            console.log('‚úÖ √âl√©ments trouv√©s:', { btn, logContainer, statusDiv });
            
            if (!btn) {
                console.error('‚ùå Bouton non trouv√©');
                return;
            }
            
            if (!logContainer) {
                console.error('‚ùå Log container non trouv√©');
                return;
            }
            
            // Log initial
            logContainer.innerHTML = '<div class="log-entry log-info">Pr√™t √† initialiser Firebase. Cliquez sur le bouton ci-dessus.</div>';
            
            // Attacher l'√©v√©nement click
            btn.addEventListener('click', () => {
                console.log('üñ±Ô∏è Clic sur le bouton');
                initializeFirestore();
            });
            
            console.log('‚úÖ Event listener attach√©');
        });
    </script>
</body>
</html>
